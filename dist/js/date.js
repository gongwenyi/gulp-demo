jQuery.fn.extend({calendar:function(e){function t(){$("#"+e.controlId).find(".tabD a").mouseup(function(){var t=new Date($("#"+e.controlId).find(".currentYear").text()+"/"+$("#"+e.controlId).find(".currentMonth").text()+"/1");if($(this).hasClass("prevD")){t.setMonth(t.getMonth()-1),t.setDate($(this).text());var n=e.speed;e.speed=0,$("#"+e.controlId).find(".prevMonth").triggerHandler("mouseup"),e.speed=n}else $(this).hasClass("nextD")&&(t.setMonth(t.getMonth()+1),t.setDate($(this).text()),n=e.speed,e.speed=0,$("#"+e.controlId).find(".nextMonth").triggerHandler("mouseup"),e.speed=n);var a=$(this).text();t=t.getFullYear()+"-"+(Number(t.getMonth()+1)<10?"0"+Number(t.getMonth()+1):Number(t.getMonth()+1))+"-"+(Number(a)<10?"0"+a:a),f.val(t),$("#"+e.controlId+" div table a").removeClass("select"),$("#"+e.controlId+" .tabD a:contains('"+a+"')").each(function(){a==$(this).text()&&!$(this).hasClass("prevD")&&!$(this).hasClass("nextD")&&$(this).addClass("select")}),$("#"+e.controlId).hide(),e.callback()}).hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})}function n(){$("#"+e.controlId).find(".tabM a").mouseup(function(){var n=r(Number($("#"+e.controlId).find(".currentYear").text()),Number($(this).attr("val")));c(n),t(),$("#"+e.controlId).find(".currentMonth").text(Number($(this).attr("val"))+1)}).hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})}function a(){$("#"+e.controlId).find(".tabY a").mouseup(function(){var n=r(Number($(this).text()),Number($("#"+e.controlId).find(".currentMonth").text())-1);c(n),t(),$("#"+e.controlId).find(".currentYear").text(Number($(this).text()))}).hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})}function r(t,n){newDate=new Date(t,n,1),newDate.setDate(0);var a=1,r=newDate.getDate();newDate.setDate(1),newDate.setMonth(newDate.getMonth()+1);var l=newDate.getDay();0==l&&(l=7),r=r-l+1,newDate.setMonth(newDate.getMonth()+1),newDate.setDate(0);var s=newDate.getDate(),o="<table class='tabD'>";o+="<tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr>";var d=u(),c="",i="",h="";e.complement||(h="style='display:none'");for(var f=0;6>f;f++){o+="<tr>";for(var v=0;7>v;v++){var $=7*f+v+1-l;i=c="",NaN!=e.lowerLimit&&e.lowerLimit>new Date(newDate.getFullYear(),newDate.getMonth(),$)||NaN!=e.upperLimit&&new Date(newDate.getFullYear(),newDate.getMonth(),$)>e.upperLimit?$>0&&s>=$?(newDate.getFullYear()==p&&newDate.getMonth()==g&&$==m&&(c="current"),o+="<td><span class='"+c+"'>"+$+"</span></td>"):0>=$?(newDate.getFullYear()==p&&newDate.getMonth()-1==g&&r==m&&(c="current"),o+="<td><span class='"+c+"' "+h+">"+r+"</span></td>",r++):$>s&&(newDate.getFullYear()==p&&newDate.getMonth()+1==g&&a==m&&(c="current"),o+="<td><span class='"+c+"' "+h+">"+a+"</span></td>",a++):$>0&&s>=$?(newDate.getFullYear()==p&&newDate.getMonth()==g&&$==m&&(c="current"),newDate.getFullYear()==d.getFullYear()&&newDate.getMonth()==d.getMonth()&&$==d.getDate()&&(i="select"),o+="<td><a class='"+i+" "+c+"'>"+$+"</a></td>"):0>=$?(newDate.getFullYear()==p&&newDate.getMonth()-1==g&&r==m&&(c="current"),newDate.getFullYear()==d.getFullYear()&&newDate.getMonth()-1==d.getMonth()&&r==d.getDate()&&(i="select"),o+="<td><a class='prevD "+i+" "+c+"' "+h+">"+r+"</a></td>",r++):$>s&&(newDate.getFullYear()==p&&newDate.getMonth()+1==g&&a==m&&(c="current"),newDate.getFullYear()==d.getFullYear()&&newDate.getMonth()+1==d.getMonth()&&a==d.getDate()&&(i="select"),o+="<td><a class='nextD "+i+" "+c+"' "+h+">"+a+"</a></td>",a++),o=o.replace("class=' '","")}o+="</tr>"}return o+="</table>"}function l(e){var t=u(),n="<table class='tabM'>";return n+="<tr>",n+="<td><a val='0' "+(e==t.getFullYear()&&0==t.getMonth()?"class='select'":"")+" "+(e==p&&0==g?"class='current'":"")+">一</a></td>",n+="<td><a val='1' "+(e==t.getFullYear()&&1==t.getMonth()?"class='select'":"")+" "+(e==p&&1==g?"class='current'":"")+">二</a></td>",n+="<td><a val='2' "+(e==t.getFullYear()&&2==t.getMonth()?"class='select'":"")+" "+(e==p&&2==g?"class='current'":"")+">三</a></td>",n+="<td><a val='3' "+(e==t.getFullYear()&&3==t.getMonth()?"class='select'":"")+" "+(e==p&&3==g?"class='current'":"")+">四</a></td>",n+="</tr>",n+="<tr>",n+="<td><a val='4' "+(e==t.getFullYear()&&4==t.getMonth()?"class='select'":"")+" "+(e==p&&4==g?"class='current'":"")+">五</a></td>",n+="<td><a val='5' "+(e==t.getFullYear()&&5==t.getMonth()?"class='select'":"")+" "+(e==p&&5==g?"class='current'":"")+">六</a></td>",n+="<td><a val='6' "+(e==t.getFullYear()&&6==t.getMonth()?"class='select'":"")+" "+(e==p&&6==g?"class='current'":"")+">七</a></td>",n+="<td><a val='7' "+(e==t.getFullYear()&&7==t.getMonth()?"class='select'":"")+" "+(e==p&&7==g?"class='current'":"")+">八</a></td>",n+="</tr>",n+="<tr>",n+="<td><a val='8' "+(e==t.getFullYear()&&8==t.getMonth()?"class='select'":"")+" "+(e==p&&8==g?"class='current'":"")+">九</a></td>",n+="<td><a val='9' "+(e==t.getFullYear()&&9==t.getMonth()?"class='select'":"")+" "+(e==p&&9==g?"class='current'":"")+">十</a></td>",n+="<td><a val='10' "+(e==t.getFullYear()&&10==t.getMonth()?"class='select'":"")+" "+(e==p&&10==g?"class='current'":"")+">十一</a></td>",n+="<td><a val='11' "+(e==t.getFullYear()&&11==t.getMonth()?"class='select'":"")+" "+(e==p&&11==g?"class='current'":"")+">十二</a></td>",n+="</tr>",n+="</table>"}function s(t){t=10*Math.floor(t/10);var n="<table class='tabY'>",a=u(),r="",l="",s="";e.complement||(s="style='display:none'");for(var o=0;3>o;o++){n+="<tr>";for(var d=0;4>d;d++)l=r="",o+1*d+1!=1&&(o+1)*(d+1)!=12?(t==a.getFullYear()&&(r="select"),t==p&&(l="current"),n+="<td><a class='"+r+" "+l+"' >"+t+"</a></td>",t++):o+1*d+1==1?(t-1==a.getFullYear()&&(r="select"),t-1==p&&(l="current"),n+="<td><a class='prevY "+r+" "+l+"' "+s+">"+(t-1)+"</a></td>"):(t==a.getFullYear()&&(r="select"),t==p&&(l="current"),n+="<td><a class='nextY "+r+" "+l+"' "+s+">"+t+"</a></td>");n+="</tr>"}return n+="</table>"}function o(t){var n=$("#"+e.controlId).find(".reserve"),a=$("#"+e.controlId).find(".enabled");n.stop(),a.stop(),n.removeClass("reserve").addClass("enabled"),a.removeClass("enabled").addClass("reserve"),n.css({"margin-left":a.width()+"px","margin-top":"0px"}),n.empty().append(t),n.animate({"margin-left":"0px"},e.speed),a.animate({"margin-left":"-"+a.width()+"px"},e.speed,function(){a.empty()})}function d(t){var n=$("#"+e.controlId).find(".reserve"),a=$("#"+e.controlId).find(".enabled");n.stop(),a.stop(),n.removeClass("reserve").addClass("enabled"),a.removeClass("enabled").addClass("reserve"),n.css({"margin-left":"-"+a.width()+"px","margin-top":"0px"}),n.empty().append(t),n.animate({"margin-left":"0px"},e.speed),a.animate({"margin-left":a.width()+"px"},e.speed,function(){a.empty()})}function c(t){var n=$("#"+e.controlId).find(".reserve"),a=$("#"+e.controlId).find(".enabled");n.stop(),a.stop(),n.removeClass("reserve").addClass("enabled"),a.removeClass("enabled").addClass("reserve"),$("#"+e.controlId).css({"z-index":1}),n.css({"z-index":-1}),a.css({"z-index":-1}),n.css({"margin-left":"0px","margin-top":a.height()+"px"}),n.empty().append(t),n.animate({"margin-top":"0px"},e.speed),a.animate({"margin-top":"-"+a.width()+"px"},e.speed,function(){a.empty(),$("#"+e.controlId).css({"z-index":0}),n.css({"z-index":0}),a.css({"z-index":0})})}function i(t){var n=$("#"+e.controlId).find(".reserve"),a=$("#"+e.controlId).find(".enabled");n.stop(),a.stop(),n.removeClass("reserve").addClass("enabled"),a.removeClass("enabled").addClass("reserve"),$("#"+e.controlId).css({"z-index":1}),n.css({"z-index":-1}),a.css({"z-index":-1}),n.css({"margin-left":"0px","margin-top":"-"+a.height()+"px"}),n.empty().append(t),n.animate({"margin-top":"0px"},e.speed),a.animate({"margin-top":a.width()+"px"},e.speed,function(){a.empty(),$("#"+e.controlId).css({"z-index":0}),n.css({"z-index":0}),a.css({"z-index":0})})}function u(){re=/(\d\d\d\d)(\W)?(\d\d)(\W)?(\d\d)/g;var e=f.val();return e=e.replace(re,"$1/$3/$5@").split("@")[0],new Date(e)}function h(e){var t=[];for(t.x=e.offsetLeft,t.y=e.offsetTop;e=e.offsetParent;)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}e=jQuery.extend({controlId:$(this).attr("id")+"Calendar",speed:50,complement:!0,readonly:!0,upperLimit:NaN,lowerLimit:NaN,callback:function(){}},e||{});var f=$(this);e.readonly&&(f.attr("readonly",!0),f.bind("keydown",function(){8==event.keyCode&&(event.keyCode=0)})),today=new Date;var p=today.getFullYear(),g=today.getMonth(),m=today.getDate(),v="";v+="<div id='"+e.controlId+"'class='calendar'>",v+="  <div class='calMain'>",v+="    <div class='calTitle'>",v+="      <a class='prevMonth'><</a><span class='t_date'><span class='currentYearText'><a class='currentYear'>"+p+"</a>年</span><span class='currentMonthText'><a class='currentMonth'>"+(g+1)+"</a>月</span></span><a class='nextMonth'>></a>",v+="    </div>",v+="    <div class='calContent'>",v+="      <div class='reserve'>",v+="      </div>",v+="      <div class='enabled'>",v+=r(p,g),v+="      </div>",v+="    </div>",v+="  </div>",v+="</div>",$("body").append(v),t(),$("#"+e.controlId).find(".prevMonth").mouseup(function(){if($("#"+e.controlId).find(".enabled > .tabD").length>0){var o=$("#"+e.controlId).find(".currentYear"),c=$("#"+e.controlId).find(".currentMonth"),i=r(Number(o.text()),Number(c.text())-2);d(i),1!=Number(c.text())?c.text(Number(c.text())-1):(o.text(Number(o.text())-1),c.text("12")),t()}else $("#"+e.controlId).find(".enabled > .tabM").length>0?(i=l(Number($("#"+e.controlId).find(".currentYear").text())-1),d(i),n(),$("#"+e.controlId).find(".currentYear").text(Number($("#"+e.controlId).find(".currentYear").text())-1)):$("#"+e.controlId).find(".enabled > .tabY").length>0&&(i=s(Number($("#"+e.controlId).find(".currentYear").text())-10),d(i),a(),$("#"+e.controlId).find(".currentYear").text(Number($("#"+e.controlId).find(".currentYear").text())-10))}),$("#"+e.controlId).find(".nextMonth").mouseup(function(){if($("#"+e.controlId).find(".enabled > .tabD").length>0){var d=$("#"+e.controlId).find(".currentYear"),c=$("#"+e.controlId).find(".currentMonth"),i=r(Number(d.text()),Number(c.text()));o(i),12!=Number(c.text())?c.text(Number(c.text())+1):(d.text(Number(d.text())+1),c.text("1")),t()}else $("#"+e.controlId).find(".enabled > .tabM").length>0?(i=l(Number($("#"+e.controlId).find(".currentYear").text())+1),o(i),n(),$("#"+e.controlId).find(".currentYear").text(Number($("#"+e.controlId).find(".currentYear").text())+1)):$("#"+e.controlId).find(".enabled > .tabY").length>0&&(i=s(Number($("#"+e.controlId).find(".currentYear").text())+10),o(i),a(),$("#"+e.controlId).find(".currentYear").text(Number($("#"+e.controlId).find(".currentYear").text())+10))}),$("#"+e.controlId).find(".currentMonthText").mouseup(function(){if(!($("#"+e.controlId).find(".enabled > .tabM").length>0)){var t=l(Number($("#"+e.controlId).find(".currentYear").text()));i(t),n()}}),$("#"+e.controlId).find(".currentYearText").mouseup(function(){if(!($("#"+e.controlId).find(".enabled > .tabY").length>0)){var t=s(Number($("#"+e.controlId).find(".currentYear").text()));i(t),a()}}),f.bind("click focus",function(){if(0!=$("#"+e.controlId+":hidden").length){$(".calendar").hide();var t=$("#"+e.controlId),n=h(f[0]),a=n.x+Number(f.attr("clientLeft"))-1;n=n.y+Number(f.attr("clientTop"))+Number(f.attr("clientHeight"))-1,t.css({top:n+"px",left:a+"px"}),a=$("#"+e.controlId).width(),n=$("#"+e.controlId).height(),t.width(0),t.height(0),t.show().animate({width:a+"px",height:n+"px"},e.speed),t.bind("selectstart",function(){return!1}).bind("mousedown",function(){return!1})}}),$(document).mouseup(function(t){$(t.target).attr("id")==f.attr("id")||0!=$(t.target).parentsUntil("#"+e.controlId).parent().length&&$(t.target).parentsUntil("#"+e.controlId).parent()[0].id==e.controlId||$("#"+e.controlId).hide()})}});